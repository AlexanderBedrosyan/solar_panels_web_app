{% extends 'base.html' %}
{% load static %}

{% block details %}
    <link rel="stylesheet" href="{% static 'pages/project-detail.css' %}">
    <title>Projects</title>
    <meta name="description" content="{{ project.title }} – проект, изпълнен от SolarTronix.">
{% endblock %}

{% block content %}
    <!-- Modern Loading Screen -->
    <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #f7f8fc, #e9ecf5, #dfe3f0); backdrop-filter: blur(6px); display: flex; justify-content: center; align-items: center; z-index: 999999; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
        <div style="text-align: center;">
            <!-- Spinning Circle Loader -->
            <div class="spinner-loader" style="width: 80px; height: 80px; margin: 0 auto 30px; border: 6px solid rgba(255, 215, 0, 0.1); border-top: 6px solid grey; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            
            <!-- Loading Text -->
            <h1 style="color: grey; font-size: 2rem; font-weight: 600; margin: 0 0 12px 0; letter-spacing: 1px;">ЗАРЕЖДАНЕ</h1>
            <p style="color: grey; font-size: 1.1rem; font-weight: 300; margin: 0; opacity: 0.9;">Моля изчакайте...</p>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #loading-screen {
            transition: opacity 0.5s ease-out;
        }
    </style>

    <div class="container my-5 page-content" id="content-card" style="opacity: 0;">
        <div>
            <h1 class="display-4">{{ project.title }}</h1>
            <img 
                src="{{ project.image_url }}" 
                alt="project-img" 
                class="project-detail-image">
            {% if project.secondary_image_url %}
                <img 
                    src="{{ project.secondary_image_url }}" 
                    alt="project-img" 
                    class="project-detail-image">
            {% endif %}
            <p>{{ project.description|linebreaksbr }}</p>
            {% if project.post_url %}
                <div><a href="{{ project.post_url }}" class="text-holder">Повече информация за проекта</a></div>
                <br>
            {% endif %}
            <a href="{% url 'projects' %}" class="btn btn-secondary">Назад към проектите</a>
        </div>
</div>
    
<div id="lightbox-overlay">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-image" src="" alt="expanded-img">
</div>


    {% include 'common/bottom-view.html' %}
    <script>
// Simple full-page loading overlay
(function() {
    const loadingScreen = document.getElementById('loading-screen');
    const pageContent = document.querySelector('.page-content');
    
    // Function to show content and hide loader
    function showPage() {
        if (loadingScreen && pageContent) {
            // Fade out loading screen
            loadingScreen.style.opacity = '0';
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                // Fade in page content
                pageContent.style.transition = 'opacity 0.6s ease-in';
                pageContent.style.opacity = '1';
            }, 500);
        }
    }
    
    // Wait for images to load
    function waitForImages() {
        const images = document.querySelectorAll('.project-detail-image');
        const imagePromises = [];
        
        images.forEach(img => {
            if (img.complete) {
                return;
            }
            
            const promise = new Promise((resolve) => {
                img.onload = resolve;
                img.onerror = resolve;
            });
            
            imagePromises.push(promise);
        });
        
        // Show page when all images loaded or after minimum time
        const minLoadTime = new Promise(resolve => setTimeout(resolve, 1000));
        
        Promise.all([...imagePromises, minLoadTime])
            .then(showPage)
            .catch(showPage);
    }
    
    // Start when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', waitForImages);
    } else {
        waitForImages();
    }
    
    // Failsafe: show page after 5 seconds no matter what
    setTimeout(showPage, 5000);
})();

// Lightbox functionality
document.addEventListener("DOMContentLoaded", function () {
    const overlay = document.getElementById("lightbox-overlay");
    const overlayImg = document.getElementById("lightbox-image");
    const closeBtn = document.getElementById("lightbox-close");

    document.querySelectorAll(".project-detail-image").forEach(img => {
        img.style.cursor = "pointer";
        img.addEventListener("click", () => {
            overlayImg.src = img.src;
            overlay.classList.add("active");
        });
    });

    closeBtn.addEventListener("click", () => {
        overlay.classList.remove("active");
    });

    overlay.addEventListener("click", (e) => {
        if (e.target === overlay) {
            overlay.classList.remove("active");
        }
    });
});
</script>

{% endblock %}