{% extends 'base.html' %}
{% load static %}

{% block details %}
    <link rel="stylesheet" href="{% static 'pages/project-detail.css' %}">
    <title>Projects</title>
    <meta name="description" content="{{ project.title }} – проект, изпълнен от SolarTronix.">
{% endblock %}

{% block content %}
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader-container">
            <div class="solar-loader">
                <div class="sun"></div>
                <div class="ray ray1"></div>
                <div class="ray ray2"></div>
                <div class="ray ray3"></div>
                <div class="ray ray4"></div>
            </div>
            <p class="loading-text">Зареждане на проект...</p>
        </div>
    </div>

    <div class="container my-5" id="content-card">
        <div>
            <h1 class="display-4">{{ project.title }}</h1>
            <img src="{{ project.image_url }}" alt="project-img">
            {% if project.secondary_image_url %}
                <img src="{{ project.secondary_image_url }}" alt="project-img">
            {% endif %}
            <p>{{ project.description|linebreaksbr }}</p>
            {% if project.post_url %}
                <div><a href="{{ project.post_url }}" class="text-holder">Повече информация за проекта</a></div>
                <br>
            {% endif %}
            <a href="{% url 'projects' %}" class="btn btn-secondary">Назад към проектите</a>
        </div>
</div>
    
<div id="lightbox-overlay">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-image" src="" alt="expanded-img">
</div>


    {% include 'common/bottom-view.html' %}
    <script>
// Loading screen logic - runs immediately
(function() {
    const loadingScreen = document.getElementById('loading-screen');
    
    // Function to hide loading screen
    function hideLoader() {
        if (loadingScreen) {
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }
    }

    // Function to check all images
    function checkImages() {
        const images = document.querySelectorAll('#content-card img');
        const totalImages = images.length;
        
        if (totalImages === 0) {
            hideLoader();
            return;
        }

        let loadedImages = 0;

        // Track image loading
        images.forEach(img => {
            if (img.complete && img.naturalHeight !== 0) {
                loadedImages++;
            } else {
                img.addEventListener('load', () => {
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        hideLoader();
                    }
                });
                img.addEventListener('error', () => {
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        hideLoader();
                    }
                });
            }
        });

        // If all images already loaded
        if (loadedImages === totalImages) {
            hideLoader();
        }
    }

    // Run when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkImages);
    } else {
        checkImages();
    }

    // Fallback: hide after 5 seconds maximum
    setTimeout(() => {
        hideLoader();
    }, 5000);
})();

// Lightbox functionality
document.addEventListener("DOMContentLoaded", function () {
    const overlay = document.getElementById("lightbox-overlay");
    const overlayImg = document.getElementById("lightbox-image");
    const closeBtn = document.getElementById("lightbox-close");

    document.querySelectorAll("#content-card img").forEach(img => {
        img.style.cursor = "pointer";
        img.addEventListener("click", () => {
            overlayImg.src = img.src;
            overlay.classList.add("active");
        });
    });

    closeBtn.addEventListener("click", () => {
        overlay.classList.remove("active");
    });

    overlay.addEventListener("click", (e) => {
        if (e.target === overlay) {
            overlay.classList.remove("active");
        }
    });
});
</script>

{% endblock %}