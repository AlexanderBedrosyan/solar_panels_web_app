{% extends 'base.html' %}
{% load static %}

{% block details %}
    <link rel="stylesheet" href="{% static 'pages/project-detail.css' %}">
    <title>Projects</title>
    <meta name="description" content="{{ project.title }} – проект, изпълнен от SolarTronix.">
{% endblock %}

{% block content %}
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader-container">
            <div class="solar-loader">
                <div class="sun"></div>
                <div class="ray ray1"></div>
                <div class="ray ray2"></div>
                <div class="ray ray3"></div>
                <div class="ray ray4"></div>
            </div>
            <p class="loading-text">Зареждане...</p>
        </div>
    </div>

    <div class="container my-5 page-content" id="content-card" style="opacity: 0;">
        <div>
            <h1 class="display-4">{{ project.title }}</h1>
            <img 
                src="{{ project.image_url }}" 
                alt="project-img" 
                class="project-detail-image">
            {% if project.secondary_image_url %}
                <img 
                    src="{{ project.secondary_image_url }}" 
                    alt="project-img" 
                    class="project-detail-image">
            {% endif %}
            <p>{{ project.description|linebreaksbr }}</p>
            {% if project.post_url %}
                <div><a href="{{ project.post_url }}" class="text-holder">Повече информация за проекта</a></div>
                <br>
            {% endif %}
            <a href="{% url 'projects' %}" class="btn btn-secondary">Назад към проектите</a>
        </div>
</div>
    
<div id="lightbox-overlay">
    <span id="lightbox-close">&times;</span>
    <img id="lightbox-image" src="" alt="expanded-img">
</div>


    {% include 'common/bottom-view.html' %}
    <script>
// Simple full-page loading overlay
(function() {
    const loadingScreen = document.getElementById('loading-screen');
    const pageContent = document.querySelector('.page-content');
    
    // Function to show content and hide loader
    function showPage() {
        if (loadingScreen && pageContent) {
            // Fade out loading screen
            loadingScreen.style.opacity = '0';
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                // Fade in page content
                pageContent.style.transition = 'opacity 0.6s ease-in';
                pageContent.style.opacity = '1';
            }, 500);
        }
    }
    
    // Wait for images to load
    function waitForImages() {
        const images = document.querySelectorAll('.project-detail-image');
        const imagePromises = [];
        
        images.forEach(img => {
            if (img.complete) {
                return;
            }
            
            const promise = new Promise((resolve) => {
                img.onload = resolve;
                img.onerror = resolve;
            });
            
            imagePromises.push(promise);
        });
        
        // Show page when all images loaded or after minimum time
        const minLoadTime = new Promise(resolve => setTimeout(resolve, 1000));
        
        Promise.all([...imagePromises, minLoadTime])
            .then(showPage)
            .catch(showPage);
    }
    
    // Start when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', waitForImages);
    } else {
        waitForImages();
    }
    
    // Failsafe: show page after 5 seconds no matter what
    setTimeout(showPage, 5000);
})();

// Lightbox functionality
document.addEventListener("DOMContentLoaded", function () {
    const overlay = document.getElementById("lightbox-overlay");
    const overlayImg = document.getElementById("lightbox-image");
    const closeBtn = document.getElementById("lightbox-close");

    document.querySelectorAll(".project-detail-image").forEach(img => {
        img.style.cursor = "pointer";
        img.addEventListener("click", () => {
            overlayImg.src = img.src;
            overlay.classList.add("active");
        });
    });

    closeBtn.addEventListener("click", () => {
        overlay.classList.remove("active");
    });

    overlay.addEventListener("click", (e) => {
        if (e.target === overlay) {
            overlay.classList.remove("active");
        }
    });
});
</script>

{% endblock %}